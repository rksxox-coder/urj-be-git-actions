<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Redirect Analyzer Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">

    <div class="max-w-3xl mx-auto bg-white p-8 rounded shadow">
        <h1 class="text-2xl font-bold mb-6 text-gray-800">BMW Redirect Analyzer</h1>

        <div class="mb-6 p-4 bg-blue-50 rounded border border-blue-200">
            <label class="block text-xs font-bold uppercase text-blue-600 mb-1">GitHub PAT Token</label>
            <input type="password" id="ghToken" class="w-full p-2 border rounded bg-white" placeholder="Paste your GitHub PAT here (repo scope)">
            <p class="text-xs text-gray-500 mt-1">Token is saved in your browser locally. Never shared.</p>
        </div>

        <div class="mb-6">
            <label class="block font-bold mb-2">Target URLs</label>
            <textarea id="urlInput" rows="8" class="w-full p-3 border rounded font-mono text-sm" placeholder="https://www.bmw.com&#10;https://www.mini.com"></textarea>
        </div>

        <div class="flex gap-4 items-center">
            <button id="runBtn" class="bg-black text-white px-6 py-2 rounded hover:bg-gray-800 transition">
                Run Analysis via GitHub Actions
            </button>
            <span id="statusMsg" class="text-sm font-semibold text-gray-600"></span>
        </div>

        <div class="mt-8 border-t pt-6">
            <h3 class="font-bold mb-2">Latest Reports</h3>
            <a href="./reports/report.html" target="_blank" class="text-blue-600 hover:underline block">
                üìÑ View Last Generated Report
            </a>
            <a href="https://github.com/YOUR_USERNAME/YOUR_REPO/actions" target="_blank" class="text-gray-500 text-sm hover:underline block mt-2">
                ‚öôÔ∏è View Job Progress in GitHub Actions
            </a>
        </div>
    </div>

    <script>
        // 1. Configuration
        const OWNER = 'rksxox-coder'; // <--- REPLACE THIS
        const REPO = 'urj-be-git-actions';       // <--- REPLACE THIS
        const WORKFLOW_FILE = 'scan.yml';    // The filename in .github/workflows/

        // 2. Load Token from Storage
        const tokenInput = document.getElementById('ghToken');
        if(localStorage.getItem('gh_pat')) {
            tokenInput.value = localStorage.getItem('gh_pat');
        }

        tokenInput.addEventListener('change', () => {
            localStorage.setItem('gh_pat', tokenInput.value);
        });

        // 3. Trigger Action
        document.getElementById('runBtn').addEventListener('click', async () => {
            const token = tokenInput.value;
            const urls = document.getElementById('urlInput').value;
            const status = document.getElementById('statusMsg');

            if (!token) return alert("Please enter a GitHub PAT Token");
            if (!urls) return alert("Please enter URLs");

            status.innerText = "Triggering GitHub Action...";
            status.className = "text-blue-600";

            try {
                const response = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/actions/workflows/${WORKFLOW_FILE}/dispatches`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        ref: 'main', // or 'master'
                        inputs: {
                            url_list: urls
                        }
                    })
                });

                if (response.ok) {
                    status.innerText = "‚úÖ Job Queued! Check GitHub Actions tab.";
                    status.className = "text-green-600";
                } else {
                    const err = await response.json();
                    throw new Error(err.message);
                }
            } catch (error) {
                status.innerText = "‚ùå Error: " + error.message;
                status.className = "text-red-600";
            }
        });
    </script>
</body>
</html>
